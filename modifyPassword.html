<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改登录密码</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <script>
        document.documentElement.style.fontSize = window.innerWidth / 7.5 + 'px';
    </script>
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/swiper-3.4.2.min.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/details.css">

    <script type='text/javascript'>
        var _vds = _vds || [];
        window._vds = _vds;
        (function(){
            _vds.push(['setAccountId', 'aeea6ff5baedd18e']);
            (function() {
                var vds = document.createElement('script');
                vds.type='text/javascript';
                vds.async = true;
                vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(vds, s);
            })();
        })();
    </script>
    <script type='text/javascript' src='https://assets.growingio.com/sdk/wx/vds-wx-plugin.js'></script>
</head>

<body>
<div class="common-header">
    <div class="icon-back" onclick="mineInfoBack()">
        <a href="#"></a>
    </div>
    <div class="common-title">
        修改登录密码
    </div>
</div>
<div class="registerModule">
    <div class="registerChange">
        <ul class="writeInfo">
            <li>
                <span class="">旧密码：</span>
                <input type="text" placeholder="请输入旧密码" value="" id="modifyPassword-old-text"/>
            </li>
            <li>
                <span class="">新密码：</span>
                <input type="text" placeholder="6-18位数字或者字母" value="" id="modifyPassword-new-text"/>
            </li>
            <li>
                <span class="">确认密码：</span>
                <input type="text" placeholder="请重复一遍新密码" value="" id="modifyPassword-sure-text"/>
            </li>
        </ul>
    </div>
    <div class="bigRegisterBtn">
        <a href="javascript:;" class="bigRedBg" id="modifyPassword-action">提交新密码</a>
    </div>
</div>

<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/handlebars-v4.0.5.js"></script>
<script src="js/mui.min.js"></script>
<script src="js/swiper-3.4.2.jquery.min.js"></script>
<script src="js/jq-plugins.js"></script>
<script src="projectJs/jQuery.md5.js"></script>
<script src="projectJs/normal.js"></script>
<script src="http://passport.cnblogs.com/scripts/jsencrypt.min.js"></script>

<script>

    function mineInfoBack(){
        window.location.href = "my.html";
    };

    $("#modifyPassword-action").click(function () {
        
        var strPass = $("#modifyPassword-old-text").val();
        if (strPass.length <= 0)
        {
            alert("请输入密码");
            return
        }

        //判断是否是字母和数字的组合
        if(!checkRate(strPass))
        {
            alert('请输入6~18位字母和数字的组合');
            return;
        }
        
        if(strPass.length < 6 || strPass.length > 18)
        {
            alert('请输入6~18位字母和数字的组合');
            return
        }


        var againPass = $("#modifyPassword-new-text").val();
        if (againPass.length <= 0)
        {
            alert("请输入确认密码");
            return
        }

        //判断是否是字母和数字的组合
        if(!checkRate(againPass))
        {
            alert('请输入6~18位字母和数字的组合');
            return;
        }

        if(againPass.length < 6 || againPass.length > 18)
        {
            alert('请输入6~18位有效的密码');
            return
        }

        var surePass = $("#modifyPassword-sure-text").val();
        if (surePass.length <= 0)
        {
            alert("请输入确认密码");
            return
        }


        //判断是否是字母和数字的组合
        if(!checkRate(surePass))
        {
            alert('请输入6~18位字母和数字的组合');
            return;
        }

        if(surePass != againPass)
        {
            alert('确认密码有误,请重新输入');
            return
        }

        var routeDetail = {};
        var encrypt=new JSEncrypt();
        encrypt.setPublicKey("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/oMXcjY1JWZsu2id4QCE+mCzO1lv9r6EKpYFM90oOwR1WDnGziD1rKeJE6Lt7QUQT9km0S+iul4YTW/zeoJhROI1TX57KFJPOaduQq/aXb8Pc5bxKk5G1+/kPJ4IG6M1BXY3UGZ3Zhn+6p88Mq3eV83/qAqG18CXyv/bN0/NEfQIDAQAB")
        routeDetail.oldPassword = encrypt.encrypt(strPass);
        routeDetail.newPassword = encrypt.encrypt(surePass);
        var dataRequest = {};
        dataRequest.requestMetaInfo = requestData();
        dataRequest.AppChangePasswordRequest = routeDetail;

        var url = "https://app.travelzen.com/tops-openapi-for-customers/service/flight/register";
        if (isOp3 == 1)
        {
            url = "http://192.168.161.137:8480/service/flight/register";
        }
        $.ajax({
            url: url,
            dataType: 'json',
            data: JSON.stringify(dataRequest),
            type: 'post',
            async:false,
            contentType: "application/json;utf-8",
            success: function (data) {
                if(data.responseMetaInfo.resultCode == 0)
                {
                    if(data.AppChangePasswordResponse.result == "FAIL")
                    {
                        alert(data.AppChangePasswordResponse.errInfo);
                    }
                    else
                    {
                        window.location.href = "my.html";
                    }
                }
                else
                {
                    alert("网络异常");
                }
            },
            error: function (data) {
                alert("网络异常");
            }
        });
    })
</script>


</body>

</html>